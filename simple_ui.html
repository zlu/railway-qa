<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Intelligent Railway RAG System - User Level Adaptive</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        .user-level-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
        }
        .level-btn {
            padding: 15px 30px;
            font-size: 18px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }
        .beginner-btn {
            background-color: #3498db;
            color: white;
        }
        .beginner-btn:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
        }
        .expert-btn {
            background-color: #e74c3c;
            color: white;
        }
        .expert-btn:hover {
            background-color: #c0392b;
            transform: translateY(-2px);
        }
        .level-btn.active {
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            transform: translateY(-2px);
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #2c3e50;
        }
        input[type="text"], select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            box-sizing: border-box;
        }
        input[type="text"]:focus, select:focus, textarea:focus {
            border-color: #3498db;
            outline: none;
        }
        textarea {
            height: 100px;
            resize: vertical;
        }
        .submit-btn {
            background-color: #27ae60;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 6px;
            font-size: 18px;
            cursor: pointer;
            width: 100%;
            transition: background-color 0.3s ease;
        }
        .submit-btn:hover {
            background-color: #229954;
        }
        .submit-btn:disabled {
            background-color: #95a5a6;
            cursor: not-allowed;
        }
        .result {
            margin-top: 30px;
            padding: 20px;
            border-radius: 8px;
            background-color: #f8f9fa;
            border-left: 4px solid #3498db;
        }
        .result h3 {
            margin-top: 0;
            color: #2c3e50;
        }
        .result-content {
            white-space: pre-wrap;
            line-height: 1.6;
            color: #34495e;
        }
        .level-info {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }
        .level-beginner {
            background-color: #3498db;
            color: white;
        }
        .level-expert {
            background-color: #e74c3c;
            color: white;
        }
        .auto-detected {
            background-color: #f39c12;
            color: white;
        }
        .loading {
            text-align: center;
            color: #7f8c8d;
            font-style: italic;
        }
        .example-questions {
            margin-top: 20px;
            padding: 15px;
            background-color: #ecf0f1;
            border-radius: 6px;
        }
        .example-questions h4 {
            margin-top: 0;
            color: #2c3e50;
        }
        .example-btn {
            display: inline-block;
            margin: 5px;
            padding: 8px 15px;
            background-color: #95a5a6;
            color: white;
            text-decoration: none;
            border-radius: 4px;
            font-size: 14px;
            transition: background-color 0.3s ease;
        }
        .example-btn:hover {
            background-color: #7f8c8d;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🚂 Intelligent Railway RAG System</h1>
        <p style="text-align: center; color: #7f8c8d; margin-bottom: 30px;">
            Supports user level adaptive responses - Auto-detect or manually select your expertise level
        </p>

        <!-- User Level Selection Buttons -->
        <div class="user-level-buttons">
            <button class="level-btn beginner-btn" onclick="selectLevel('beginner')">
                🆕 Beginner Mode
            </button>
            <button class="level-btn expert-btn" onclick="selectLevel('expert')">
                🔧 Expert Mode
            </button>
            <button class="level-btn" onclick="selectLevel('auto')" style="background-color: #f39c12; color: white;">
                🤖 Auto-Detect
            </button>
        </div>

        <!-- Question Input Form -->
        <form id="questionForm">
            <div class="form-group">
                <label for="question">Your Question:</label>
                <textarea id="question" name="question" placeholder="Enter your question, the system will provide appropriate responses based on your selected level..." required></textarea>
            </div>

            <div class="form-group">
                <label for="documentType">Document Type:</label>
                <select id="documentType" name="documentType">
                    <option value="railway">Railway Documents</option>
                    <option value="door_control">Door Control Maintenance Guide</option>
                    <option value="combined">Combined Search</option>
                </select>
            </div>

            <div class="form-group">
                <label for="llmModel">AI Model:</label>
                <select id="llmModel" name="llmModel">
                    <option value="gemma3">Gemma3 (Recommended)</option>
                    <option value="deepseek-r1">DeepSeek-R1</option>
                </select>
            </div>

            <button type="submit" class="submit-btn" id="submitBtn">
                Send Question
            </button>
        </form>

        <!-- Example Questions -->
        <div class="example-questions">
            <h4>💡 Example Questions:</h4>
            <a href="#" class="example-btn" onclick="setExample('beginner', 'What are the basic maintenance steps for door control units?')">Beginner: Basic Maintenance Steps</a>
            <a href="#" class="example-btn" onclick="setExample('expert', 'What are the technical parameters and advanced troubleshooting methods for door control systems?')">Expert: Technical Parameters & Troubleshooting</a>
            <a href="#" class="example-btn" onclick="setExample('beginner', 'How to safely perform door control maintenance?')">Beginner: Safety Precautions</a>
            <a href="#" class="example-btn" onclick="setExample('expert', 'What are the system integration and optimization recommendations for door control systems?')">Expert: System Integration & Optimization</a>
        </div>

        <!-- Result Display Area -->
        <div id="result" class="result" style="display: none;">
            <h3>Response Result <span id="levelBadge" class="level-info"></span></h3>
            <div id="resultContent" class="result-content"></div>
        </div>
    </div>

    <script>
        let selectedLevel = 'auto';
        let currentLevel = '';

        function selectLevel(level) {
            selectedLevel = level;
            
            // 更新按钮状态
            document.querySelectorAll('.level-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Update placeholder text
            const questionTextarea = document.getElementById('question');
            if (level === 'beginner') {
                questionTextarea.placeholder = 'Enter your question, the system will answer in a beginner-friendly way...';
            } else if (level === 'expert') {
                questionTextarea.placeholder = 'Enter your question, the system will provide professional technical details...';
            } else {
                questionTextarea.placeholder = 'Enter your question, the system will automatically detect your expertise level and adjust the response...';
            }
        }

        function setExample(level, question) {
            selectLevel(level);
            document.getElementById('question').value = question;
        }

        document.getElementById('questionForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submitBtn');
            const resultDiv = document.getElementById('result');
            
            // Show loading state
            submitBtn.disabled = true;
            submitBtn.textContent = 'Processing...';
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<div class="loading">Generating response, please wait...</div>';
            
            // Prepare request data
            const formData = {
                question: document.getElementById('question').value,
                document_type: document.getElementById('documentType').value,
                llm_model: document.getElementById('llmModel').value,
                user_level: selectedLevel === 'auto' ? null : selectedLevel
            };
            
            try {
                const response = await fetch('/ask', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });
                
                const data = await response.json();
                
                // Display results
                const levelBadge = document.getElementById('levelBadge');
                const resultContent = document.getElementById('resultContent');
                
                // Set level badge
                if (data.auto_detected) {
                    levelBadge.textContent = 'Auto-Detected';
                    levelBadge.className = 'level-info auto-detected';
                } else {
                    levelBadge.textContent = data.user_level === 'beginner' ? 'Beginner Mode' : 'Expert Mode';
                    levelBadge.className = `level-info level-${data.user_level}`;
                }
                
                // Display response content
                resultContent.textContent = data.answer;
                
                // Display statistics
                const stats = `\n\n---\nResponse Length: ${data.answer_length} characters | Document Type: ${data.document_type} | User Level: ${data.user_level}`;
                resultContent.textContent += stats;
                
            } catch (error) {
                resultDiv.innerHTML = `<div style="color: #e74c3c;">Error: ${error.message}</div>`;
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Send Question';
            }
        });

        // Select auto-detect when page loads
        selectLevel('auto');
    </script>
</body>
</html>
